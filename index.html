<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; padding: 20px; }
        .box { background: #111; border: 1px solid #333; padding: 15px; border-radius: 12px; margin-bottom: 10px; }
        .error { color: #ff4444; word-break: break-all; font-family: monospace; font-size: 12px; }
        .success { color: #44ff44; }
    </style>
</head>
<body>
    <h1 class="text-xl font-bold mb-4">System Diagnose</h1>
    
    <div id="status" class="box">
        <p class="text-gray-500">Initializing...</p>
    </div>

    <div id="app" class="space-y-2"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- ПРОВЕРЬ ЭТУ ССЫЛКУ!!! ---
        // Вставь сюда то, что выдал journalctl -u cloudflared
        const API_URL = "https://councils-unnecessary-springfield-essay.trycloudflare.com/api/versions";

        function log(msg, type = 'text-gray-500') {
            document.getElementById('status').innerHTML += `<p class="${type}">${msg}</p>`;
        }

        async function debugFetch() {
            const container = document.getElementById('app');
            document.getElementById('status').innerHTML = '<p class="text-blue-400">Step 1: Starting Request...</p>';
            
            log(`Target: ${API_URL}`, 'text-yellow-500');

            try {
                const response = await fetch(`${API_URL}?t=${Date.now()}`);
                
                log(`Step 2: Response Status: ${response.status}`, response.ok ? 'success' : 'error');

                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const data = await response.json();
                log(`Step 3: Data JSON Parsed`, 'success');
                
                // Рендер данных
                container.innerHTML = data.map(item => `
                    <div class="box border-green-900">
                        <div class="font-bold">${item.name}</div>
                        <div class="text-xl">${item.version}</div>
                        <div class="text-xs text-gray-500">${item.date}</div>
                    </div>
                `).join('');

            } catch (e) {
                console.error(e);
                log(`CRITICAL ERROR: ${e.message}`, 'error');
                container.innerHTML = `
                    <div class="box border-red-900 bg-red-900/20">
                        <p class="font-bold text-red-500">CONNECTION FAILED</p>
                        <p class="text-xs mt-2">Possible reasons:</p>
                        <ul class="list-disc ml-4 text-xs text-gray-400">
                            <li>Wrong Cloudflare URL in index.html</li>
                            <li>Python bot is stopped</li>
                            <li>Cloudflared tunnel is down</li>
                        </ul>
                    </div>
                `;
            }
        }

        // Кнопка перезагрузки
        tg.MainButton.setText('TEST CONNECTION');
        tg.MainButton.show();
        tg.onEvent('mainButtonClicked', () => location.reload());

        debugFetch();
    </script>
</body>
</html>
